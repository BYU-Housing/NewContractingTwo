@page "/dynamicPortal"
@inject IGenService GenService
@inject NavigationManager NavigationManager

<h3>DynamicPortal</h3>

<p>Select Eligibility:</p>
<div>
    <label>
        <input type="radio" name="eligibility" value="true" @onchange="OnEligibilityChanged" checked="@((eligibility == true))" />
        Yes
    </label>
</div>
<div>
    <label>
        <input type="radio" name="eligibility" value="false" @onchange="OnEligibilityChanged" checked="@((eligibility == false))" />
        No
    </label>
</div>

<p>Select Age Group:</p>
<div>
    <label>
        <input type="radio" name="ageGroup" value="true" @onchange="OnAgeGroupChanged" checked="@((ageGroup == true))" />
        18-
    </label>
</div>
<div>
    <label>
        <input type="radio" name="ageGroup" value="false" @onchange="OnAgeGroupChanged" checked="@((ageGroup == false))" />
        19+
    </label>
</div>

<p>
    Select Priority Date Helaman Halls Timestamp:
    <input type="datetime-local" @bind="PDHL" class="form-control" />
</p>

<p>
    Select Priority Date Heritage Halls Timestamp (Priority Date Heritage Halls):
    <input type="datetime-local" @bind="PDHR" class="form-control" />
</p>

<p>
    Select Priority Date CDRI Timestamp:
    <input type="datetime-local" @bind="CDRI" class="form-control" />
</p>

<p>
    Select Priority Date CDWP Timestamp:
    <input type="datetime-local" @bind="CDWP" class="form-control" />
</p>

<p>
    <button @onclick="NavigateToStepOne" class="btn btn-primary" disabled="@(eligibility == null || ageGroup == null)">Go To Select Area</button>
</p>

<p>
    Selected Eligibility: @(eligibility.HasValue ? (eligibility.Value ? "Yes" : "No") : "Not Selected")
</p>

<p>
    Selected Age Group: @(ageGroup.HasValue ? (ageGroup.Value ? "18-" : "19+") : "Not Selected")
</p>

<p>
    Selected Priority Date Helaman Halls: @(PDHL.HasValue ? PDHL.Value.ToString("yyyy-MM-dd HH:mm:ss") : "Not Set")
</p>

<p>
    Selected Priority Date Heritage Halls: @(PDHR.HasValue ? PDHR.Value.ToString("yyyy-MM-dd HH:mm:ss") : "Not Set")
</p>

<p>
    Selected Priority Date CDRI: @(CDRI.HasValue ? CDRI.Value.ToString("yyyy-MM-dd HH:mm:ss") : "Not Set")
</p>

<p>
    Selected Priority Date CDWP: @(CDWP.HasValue ? CDWP.Value.ToString("yyyy-MM-dd HH:mm:ss") : "Not Set")
</p>

@code {
    private bool? eligibility = null;
    private bool? ageGroup = null; // True = 18-, False = 19+
    private DateTime? PDHL = null; // Priority Date Helaman Halls
    private DateTime? PDHR = null; // Priority Date Heritage Halls
    private DateTime? CDRI = null; // Priority Date CDRI
    private DateTime? CDWP = null; // Priority Date CDWP

    private void OnEligibilityChanged(ChangeEventArgs e)
    {
        if (bool.TryParse(e.Value?.ToString(), out var result))
        {
            eligibility = result;
        }
    }

    private void OnAgeGroupChanged(ChangeEventArgs e)
    {
        if (bool.TryParse(e.Value?.ToString(), out var result))
        {
            ageGroup = result;
        }
    }

    private void NavigateToStepOne()
    {
        if (eligibility.HasValue && ageGroup.HasValue)
        {
            // If timestamps are not set, default them to the current time
            PDHL ??= DateTime.Now;
            PDHR ??= DateTime.Now;
            CDRI ??= DateTime.Now;
            CDWP ??= DateTime.Now;

            // Append parameters to the URL
            var eligibilityParam = eligibility.Value ? "true" : "false";
            var ageGroupParam = ageGroup.Value ? "true" : "false";
            var pdhlParam = PDHL.Value.ToString("yyyy-MM-ddTHH:mm:ss");
            var pdhrParam = PDHR.Value.ToString("yyyy-MM-ddTHH:mm:ss");
            var cdriParam = CDRI.Value.ToString("yyyy-MM-ddTHH:mm:ss");
            var cdwpParam = CDWP.Value.ToString("yyyy-MM-ddTHH:mm:ss");
            NavigationManager.NavigateTo($"/dynamicPortalStepOneSelectArea?Ebt={eligibilityParam}&AgeGroup={ageGroupParam}&PDHL={pdhlParam}&PDHR={pdhrParam}&CDRI={cdriParam}&CDWP={cdwpParam}");
        }
    }
}
