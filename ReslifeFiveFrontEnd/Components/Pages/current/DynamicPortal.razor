@page "/dynamicPortal"
@inject IGenService GenService
@inject NavigationManager NavigationManager

<h3>DynamicPortal</h3>

<p>Select Eligibility:</p>
<div>
    <label>
        <input type="radio" name="eligibility" value="true" @onchange="OnEligibilityChanged" checked="@((eligibility == true))" />
        Yes
    </label>
</div>
<div>
    <label>
        <input type="radio" name="eligibility" value="false" @onchange="OnEligibilityChanged" checked="@((eligibility == false))" />
        No
    </label>
</div>

<p>
    Select Priority Date Helaman Halls Timestamp:
    <input type="datetime-local" @bind="PDHL" class="form-control" />
</p>

<p>
    Select Priority Date Heritage Halls Timestamp (Priority Date Heritage Halls):
    <input type="datetime-local" @bind="PDHR" class="form-control" />
</p>

<p>
    <button @onclick="NavigateToStepOne" class="btn btn-primary" disabled="@(eligibility == null)">Go To Select Area</button>
</p>

<p>
    Selected Eligibility: @(eligibility.HasValue ? (eligibility.Value ? "Yes" : "No") : "Not Selected")
</p>

<p>
    Selected Priority Date Helaman Halls: @(PDHL.HasValue ? PDHL.Value.ToString("yyyy-MM-dd HH:mm:ss") : "Not Set")
</p>

<p>
    Selected Priority Date Heritage Halls: @(PDHR.HasValue ? PDHR.Value.ToString("yyyy-MM-dd HH:mm:ss") : "Not Set")
</p>

@code {
    private bool? eligibility = null;
    private DateTime? PDHL = null; // Priority Date Helaman Halls
    private DateTime? PDHR = null; // Priority Date Heritage Halls

    private void OnEligibilityChanged(ChangeEventArgs e)
    {
        if (bool.TryParse(e.Value?.ToString(), out var result))
        {
            eligibility = result;
        }
    }

    private void NavigateToStepOne()
    {
        if (eligibility.HasValue)
        {
            // If timestamps are not set, default them to the current time
            PDHL ??= DateTime.Now;
            PDHR ??= DateTime.Now;

            // Append parameters to the URL
            var eligibilityParam = eligibility.Value ? "true" : "false";
            var pdhlParam = PDHL.Value.ToString("yyyy-MM-ddTHH:mm:ss");
            var pdhrParam = PDHR.Value.ToString("yyyy-MM-ddTHH:mm:ss");
            NavigationManager.NavigateTo($"/dynamicPortalStepOneSelectArea?Ebt={eligibilityParam}&PDHL={pdhlParam}&PDHR={pdhrParam}");
        }
    }
}


