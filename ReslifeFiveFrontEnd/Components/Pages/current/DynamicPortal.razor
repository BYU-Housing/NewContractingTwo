@page "/dynamicPortal"
@inject IGenService GenService
@inject NavigationManager NavigationManager

<h3>DynamicPortal</h3>

<p>Select Eligibility:</p>
<div>
    <label>
        <input type="radio" name="eligibility" value="true" @onchange="OnEligibilityChanged" checked="@((eligibility == true))" />
        Yes
    </label>
</div>
<div>
    <label>
        <input type="radio" name="eligibility" value="false" @onchange="OnEligibilityChanged" checked="@((eligibility == false))" />
        No
    </label>
</div>

<p>
    Selected Eligibility: @(eligibility.HasValue ? (eligibility.Value ? "Yes" : "No") : "Not Selected")
</p>

<p>
    Select PDHL Timestamp:
    <input type="datetime-local" @bind="PDHL" class="form-control" />
</p>

<p>
    <button @onclick="NavigateToStepOne" class="btn btn-primary" disabled="@(eligibility == null)">Go To Select Area</button>
</p>

<p>
    Selected PDHL: @(PDHL.HasValue ? PDHL.Value.ToString("yyyy-MM-dd HH:mm:ss") : "Not Set")
</p>

@code {
    private bool? eligibility = null;
    private DateTime? PDHL = null;

    private void OnEligibilityChanged(ChangeEventArgs e)
    {
        if (bool.TryParse(e.Value?.ToString(), out var result))
        {
            eligibility = result;
        }
    }

    private void NavigateToStepOne()
    {
        if (eligibility.HasValue)
        {
            // If PDHL is not set, default it to the current time
            PDHL ??= DateTime.Now;

            // Append parameters to the URL
            var eligibilityParam = eligibility.Value ? "true" : "false";
            var pdhlParam = PDHL.Value.ToString("yyyy-MM-ddTHH:mm:ss");
            NavigationManager.NavigateTo($"/dynamicPortalStepOneSelectArea?Ebt={eligibilityParam}&PDHL={pdhlParam}");
        }
    }
}

