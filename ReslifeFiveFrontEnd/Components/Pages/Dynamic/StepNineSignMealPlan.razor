@page "/stepNineSignMealPlanAgreement"
@inject NavigationManager NavigationManager
@inject IGenService GenService

<h3>Step Nine: Sign Meal Plan Agreement</h3>

<div>
    <h4>Selected Meal Plan:</h4>
    <p>@SelectedMealPlanDisplay</p>
    <h4>Daily Rate:</h4>
    <p>@SelectedMealPlanRate</p>
    <h4>NetID:</h4>
    <p>@NetID</p>
</div>

@code {
    private int? SelectedMealPlan; // Nullable to handle missing parameter
    private string SelectedMealPlanDisplay = "Not specified";
    private decimal SelectedMealPlanRate = 0.00m; // Default rate if no meal plan is selected
    private string NetID = "Not specified"; // Default value for NetID

    // Dictionary to map integers to meal plan names and their corresponding daily rates
    private readonly Dictionary<int, (string Name, decimal Rate)> MealPlans = new()
    {
        { 1, ("19+", 10.00m) },
        { 2, ("Dining Plus", 11.00m) },
        { 3, ("EZ Dining 100", 12.00m) },
        { 4, ("EZ Dining 150", 13.00m) },
        { 5, ("EZ Dining 200", 14.00m) },
        { 6, ("Open Door", 15.00m) },
        { 7, ("True Blue Dining 500", 16.00m) },
        { 8, ("True Blue Dining 500 Weekly", 17.00m) },
        { 9, ("True Blue Dining 800", 18.00m) },
        { 10, ("True Blue Dining 800 Weekly", 19.00m) },
        { 11, ("No Meal Plan", 20.00m) }
    };

    protected override void OnInitialized()
    {
        // Parse the current URL to extract parameters
        var uri = new Uri(NavigationManager.Uri);
        var queryParams = Microsoft.AspNetCore.WebUtilities.QueryHelpers.ParseQuery(uri.Query);

        // Extract SelectedMealPlan parameter
        if (queryParams.TryGetValue("SelectedMealPlan", out var mealPlanValue) &&
            int.TryParse(mealPlanValue, out var parsedMealPlan))
        {
            SelectedMealPlan = parsedMealPlan;

            // Lookup the meal plan name and rate in the dictionary
            if (MealPlans.TryGetValue(parsedMealPlan, out var mealPlanInfo))
            {
                SelectedMealPlanDisplay = mealPlanInfo.Name;
                SelectedMealPlanRate = mealPlanInfo.Rate;
            }
            else
            {
                SelectedMealPlanDisplay = "Unknown Meal Plan";
                SelectedMealPlanRate = 0.00m;
            }
        }

        // Extract NetID parameter
        if (queryParams.TryGetValue("NetID", out var netIDValue))
        {
            NetID = netIDValue!;
        }
    }
}

