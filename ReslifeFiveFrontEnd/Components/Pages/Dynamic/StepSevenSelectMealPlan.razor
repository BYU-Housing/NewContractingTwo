@page "/stepSevenSelectMealPlan"
@inject NavigationManager NavigationManager
@inject IGenService GenService

<h3>Step Seven: Select Meal Plan</h3>

<div class="row">
    <!-- Left-side: Buttons -->
    <div class="col-md-3">
        <div class="button-container">
            @foreach (var plan in MealPlans)
            {
                <button class="btn @(SelectedMealPlan == plan ? "btn-success" : "btn-primary") mb-2 w-100"
                        @onclick="() => SelectMealPlan(plan)">
                    @plan
                </button>
            }
        </div>
    </div>

    <!-- Right-side: Content -->
    <div class="col-md-9">
        <div class="content-container">
            @if (SelectedMealPlan != null)
            {
                <p>@MealPlanDescriptions[SelectedMealPlan]</p>
                <div class="mt-3">
                    <h5>Do you have any dietary restrictions?</h5>
                    <div>
                        <input type="radio" id="yes" name="dietaryRestrictions" value="yes" checked="@(HasDietaryRestrictions == true)" @onchange="() => HandleDietaryRestrictionsChange(true)" />
                        <label for="yes">Yes</label>
                    </div>
                    <div>
                        <input type="radio" id="no" name="dietaryRestrictions" value="no" checked="@(HasDietaryRestrictions == false)" @onchange="() => HandleDietaryRestrictionsChange(false)" />
                        <label for="no">No</label>
                    </div>
                </div>

                @if (HasDietaryRestrictions == true)
                {
                    <div class="mt-3">
                        <h5>Please provide a description of your dietary restrictions:</h5>
                        <textarea class="form-control" @bind="DietaryRestrictionDescription" rows="3"></textarea>
                    </div>
                }
                else if (HasDietaryRestrictions == false)
                {
                    <div class="mt-3">
                        <button class="btn btn-primary" @onclick="ProceedToSignAgreement">Proceed to Sign Agreement</button>
                    </div>
                }
            }
            else
            {
                <p>Please select a meal plan to see details.</p>
            }
        </div>
    </div>
</div>

@code {
    private List<string> MealPlans = new List<string>
    {
        "19 + ",
        "Dining Plus",
        "EZ Dining 100",
        "EZ Dining 150",
        "EZ Dining 200",
        "Open Door",
        "True Blue Dining 500",
        "True Blue Dining 500 Weekly",
        "True Blue Dining 800",
        "True Blue Dining 800 Weekly",
        "No Meal Plan"
    };

    private Dictionary<string, string> MealPlanDescriptions = new Dictionary<string, string>
    {
        { "19 + ", "This meal plan offers 19 meals per week with unlimited access to the dining halls." },
        { "Dining Plus", "Dining Plus provides a flexible balance of dining hall meals and on-campus restaurant credits." },
        { "EZ Dining 100", "The EZ Dining 100 plan includes 100 dining dollars for use across campus." },
        { "EZ Dining 150", "The EZ Dining 150 plan includes 150 dining dollars for use across campus." },
        { "EZ Dining 200", "The EZ Dining 200 plan includes 200 dining dollars for use across campus." },
        { "Open Door", "Open Door offers access to dining halls with pay-per-meal options." },
        { "True Blue Dining 500", "True Blue Dining 500 provides 500 meals per semester with access to premium options." },
        { "True Blue Dining 500 Weekly", "True Blue Dining 500 Weekly offers 500 meals per semester, distributed weekly." },
        { "True Blue Dining 800", "True Blue Dining 800 provides 800 meals per semester with access to all dining facilities." },
        { "True Blue Dining 800 Weekly", "True Blue Dining 800 Weekly offers 800 meals per semester, distributed weekly." },
        { "No Meal Plan", "No Meal Plan allows students to opt out of on-campus dining options." }
    };

    private string? SelectedMealPlan;
    private bool? HasDietaryRestrictions; // Tracks the state of the radio buttons
    private string DietaryRestrictionDescription = string.Empty;

    private void SelectMealPlan(string plan)
    {
        SelectedMealPlan = plan;
        ResetDietaryRestrictions(); // Reset both radio buttons and description
        StateHasChanged(); // Ensure UI updates immediately
    }

    private void HandleDietaryRestrictionsChange(bool hasRestrictions)
    {
        HasDietaryRestrictions = hasRestrictions;

        if (!hasRestrictions)
        {
            DietaryRestrictionDescription = string.Empty; // Clear the description if "No" is selected
        }
    }

    private void ResetDietaryRestrictions()
    {
        HasDietaryRestrictions = null; // Reset the radio buttons
        DietaryRestrictionDescription = string.Empty; // Clear the description
    }

    private void ProceedToSignAgreement()
    {
        Console.WriteLine("User is proceeding to sign the agreement.");
        // Add logic to navigate to the agreement page or perform other actions
    }
}
