@page "/stepEightSignHousingAgreement"
@inject NavigationManager NavigationManager
@inject IGenService GenService

<h3>Step Eight: Sign Housing Agreement</h3>

<p>Area: @AreaDisplayName</p>
<p>NetID: @NetID</p>
<p>Name: @Name</p>

<!-- Embedded Adobe Sign form -->
<div style="width: 100%; height: 100%; border: 0; overflow: hidden;">
    <iframe src="@IframeUrl"
            style="width: 100%; height: 500px; border: none;">
    </iframe>
</div>

@code {
    private string AreaDisplayName = "Not specified";
    private string NetID = "Not specified";
    private string Name = "Not specified";
    private string IframeUrl = "https://byusign.na2.adobesign.com/public/esignWidget?wid=CBFCIBAA3AAABLblqZhB3CgMCc6i3412faQKEurYXc9N5vLkQEIcvpUSIL2F7Oz9Pazk4i0IiIV5YcP3bn00*&hosted=false";

    protected override void OnInitialized()
    {
        var uri = new Uri(NavigationManager.Uri);
        var queryParams = Microsoft.AspNetCore.WebUtilities.QueryHelpers.ParseQuery(uri.Query);

        // Retrieve the Name value and set P1
        if (queryParams.TryGetValue("Name", out var nameValue))
        {
            Name = nameValue.ToString() ?? "Not specified";
            IframeUrl += $"#P1={Uri.EscapeDataString(Name)}";
        }

        // Retrieve the NetID value and set P2
        if (queryParams.TryGetValue("NetID", out var netIDValue))
        {
            NetID = netIDValue.ToString() ?? "Not specified";
            IframeUrl += $"&P2={Uri.EscapeDataString(NetID)}";
        }

        // Retrieve the Area value and set P3
        if (queryParams.TryGetValue("Area", out var areaValue) && int.TryParse(areaValue.ToString(), out var area))
        {
            AreaDisplayName = area switch
            {
                1 => "Helaman Halls",
                2 => "Heritage Halls",
                3 => "Riviera",
                4 => "Wyview Park",
                _ => "Unknown Area"
            };

            IframeUrl += $"&P3={Uri.EscapeDataString(AreaDisplayName)}";
        }
    }
}
