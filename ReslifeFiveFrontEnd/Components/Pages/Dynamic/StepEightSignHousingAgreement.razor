@page "/stepEightSignHousingAgreement"
@inject NavigationManager NavigationManager
@inject IGenService GenService

<h3>Step Eight: Sign Housing Agreement</h3>

<p>Area: @AreaDisplayName</p>

<!-- Embedded Adobe Sign form -->
<div style="width: 100%; height: 100%; border: 0; overflow: hidden;">
    <iframe src="@IframeUrl"
            style="width: 100%; height: 500px; border: none;">
    </iframe>
</div>

@code {
    private string AreaDisplayName = "Not specified";
    private string IframeUrl = "https://byusign.na2.adobesign.com/public/esignWidget?wid=CBFCIBAA3AAABLblqZhB3CgMCc6i3412faQKEurYXc9N5vLkQEIcvpUSIL2F7Oz9Pazk4i0IiIV5YcP3bn00*&hosted=false";

    protected override void OnInitialized()
    {
        var uri = new Uri(NavigationManager.Uri);
        var queryParams = Microsoft.AspNetCore.WebUtilities.QueryHelpers.ParseQuery(uri.Query);

        if (queryParams.TryGetValue("Area", out var areaValue) && int.TryParse(areaValue, out var area))
        {
            AreaDisplayName = area switch
            {
                1 => "Helaman Halls",
                2 => "Heritage Halls",
                3 => "Riviera",
                4 => "Wyview Park",
                _ => "Unknown Area"
            };

            // Append the area display name to the iframe URL
            IframeUrl += $"#P1={AreaDisplayName}";
        }
    }
}
