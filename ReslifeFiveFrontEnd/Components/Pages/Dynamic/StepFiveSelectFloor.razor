@page "/stepFiveSelectFloor"
@inject NavigationManager NavigationManager

<h3>Step Five: Select Floor</h3>

<!-- Display Blocks Based on Area -->
<div class="row justify-content-center mt-4">
    @foreach (var block in AvailableBlocks)
    {
        <div class="col-md-4 mb-3">
            <div class="card">
                <div class="card-body text-center">
                    <h5 class="card-title">Floor @block</h5>
                    <button class="btn btn-primary" @onclick="() => NavigateToStepSix(block)">Select</button>
                </div>
            </div>
        </div>
    }
</div>

<!-- Display URL Parameters as a String -->
<div class="mt-4">
    <h4>URL Parameters</h4>
    <p>@UrlParametersString</p>
</div>

@code {
    private string UrlParametersString = string.Empty;
    private List<string> AvailableBlocks = new();
    private int? Area;

    protected override void OnInitialized()
    {
        var uri = NavigationManager.ToAbsoluteUri(NavigationManager.Uri);
        var query = System.Web.HttpUtility.ParseQueryString(uri.Query);

        // Generate a string of URL parameters
        UrlParametersString = string.Join(", ", query.AllKeys.Select(key => $"{key}={query[key]}"));

        // Parse the Area parameter
        if (query["Area"] != null && int.TryParse(query["Area"], out var area))
        {
            Area = area;
            SetAvailableBlocks();
        }
    }

    private void SetAvailableBlocks()
    {
        AvailableBlocks = Area switch
        {
            1 => new List<string> { "1100", "1200", "2100", "2000", "2200", "3100", "3200" },
            2 => new List<string> { "1", "2", "3", "4" },
            3 => new List<string> { "1", "2", "3" },
            4 => new List<string> { "1", "2", "3" },
            _ => new List<string> { "No blocks available for this area" }
        };
    }

    private void NavigateToStepSix(string block)
    {
        // Construct query string with the selected floor
        var queryParams = $"{UrlParametersString}&Floor={block}";
        NavigationManager.NavigateTo($"/stepSixSelectBedspace?{queryParams}");
    }
}
